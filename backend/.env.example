# FlowMaestro Backend Environment Configuration
# ===========================================
#
# QUICK START FOR NEW DEVELOPERS:
# 1. Run: ../infra/scripts/sync-secrets-local.sh
#    (This pulls all secrets from GCP Secret Manager and creates backend/.env automatically)
# 2. Start infrastructure: npm run docker:up (from project root)
# 3. Run migrations: npm run db:migrate (from project root)
# 4. Start dev servers: npm run dev (from project root)
#
# NOTE: You should NOT manually copy this file. Instead, use the sync-secrets-local.sh
# script which automatically fetches all values from GCP Secret Manager and creates
# backend/.env for you.
#
# WARNING: backend/.env contains sensitive information and is already in .gitignore.
# NEVER commit .env files to git!

# ==============================================================================
# Core Application
# ==============================================================================
NODE_ENV=development
LOG_LEVEL=debug

# Timezone - MUST be UTC to prevent timezone mismatches with PostgreSQL
# This ensures consistent timestamp handling across the application
TZ=UTC

# ==============================================================================
# Database Configuration
# ==============================================================================
# These are auto-populated by sync-secrets-local.sh from GCP Secret Manager
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=flowmaestro
POSTGRES_USER=flowmaestro
POSTGRES_PASSWORD=flowmaestro_dev_password

# Connection string (constructed automatically by sync script)
DATABASE_URL=postgresql://flowmaestro:flowmaestro_dev_password@localhost:5432/flowmaestro

# ==============================================================================
# Redis Configuration
# ==============================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_URL=redis://localhost:6379

# ==============================================================================
# Security Secrets
# ==============================================================================
# JWT Secret for authentication tokens
# Auto-generated by sync-secrets-local.sh or manually generate with:
# openssl rand -base64 64 | tr -d "=+/" | cut -c1-64
JWT_SECRET=dev-jwt-secret-change-in-production

# Encryption Key for credentials storage
# MUST be 64 hex characters (32 bytes)
# Auto-generated by sync-secrets-local.sh or manually generate with:
# openssl rand -hex 32
ENCRYPTION_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

# ==============================================================================
# LLM API Keys
# ==============================================================================
# These are optional for basic development but required for AI features
# Sync from Secret Manager with: ./infra/scripts/sync-secrets-local.sh
# Alternatively, use Connections in the UI to manage API keys per-workflow
#
# OpenAI API Key: https://platform.openai.com/api-keys
OPENAI_API_KEY=
#
# Anthropic API Key: https://console.anthropic.com/settings/keys
ANTHROPIC_API_KEY=
#
# Google AI API Key: https://aistudio.google.com/apikey
# For production/enterprise: Use Vertex AI via Google Cloud Console
GOOGLE_API_KEY=
#
# Cohere API Key: https://dashboard.cohere.com/api-keys
COHERE_API_KEY=
#
# Hugging Face API Key: https://huggingface.co/settings/tokens
# Create a fine-grained token with "Make calls to Inference Providers" permission
HUGGINGFACE_API_KEY=

# ==============================================================================
# OAuth Integration Secrets
# ==============================================================================
# Required for testing OAuth integrations with external services
# Sync from Secret Manager with: ./infra/scripts/sync-secrets-local.sh

# Slack
SLACK_CLIENT_ID=
SLACK_CLIENT_SECRET=

# Google (used for Sheets, Drive, Calendar, Gmail, and user authentication)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# Notion
NOTION_CLIENT_ID=
NOTION_CLIENT_SECRET=

# Airtable
AIRTABLE_CLIENT_ID=
AIRTABLE_CLIENT_SECRET=

# HubSpot
HUBSPOT_CLIENT_ID=
HUBSPOT_CLIENT_SECRET=

# Salesforce
# Create a Connected App at Setup > App Manager > New Connected App
# Enable OAuth Settings and add callback URL: {API_URL}/api/oauth/salesforce/callback
# Required scopes: Full access (full), Perform requests at any time (refresh_token, offline_access)
SALESFORCE_CLIENT_ID=
SALESFORCE_CLIENT_SECRET=

# GitHub
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=

# Linear
LINEAR_CLIENT_ID=
LINEAR_CLIENT_SECRET=

# Figma
FIGMA_CLIENT_ID=
FIGMA_CLIENT_SECRET=

# Microsoft (OneDrive, Excel, Word, Teams, Outlook, etc.)
MICROSOFT_CLIENT_ID=
MICROSOFT_CLIENT_SECRET=

# Meta Platform (WhatsApp, Instagram, Messenger, Facebook Ads)
# Create a Meta App at https://developers.facebook.com/apps/
META_APP_ID=
META_APP_SECRET=
# Optional: WhatsApp Embedded Signup configuration ID
META_WHATSAPP_CONFIG_ID=
# Webhook verification token (you set this value, then configure the same in Meta dashboard)
META_WEBHOOK_VERIFY_TOKEN=

# Zendesk
# Create OAuth app at https://YOUR_SUBDOMAIN.zendesk.com/admin/apps-integrations/apis/zendesk-api/oauth_clients
ZENDESK_CLIENT_ID=
ZENDESK_CLIENT_SECRET=

# Apollo.io
APOLLO_CLIENT_ID=
APOLLO_CLIENT_SECRET=

# Jira Cloud
JIRA_CLIENT_ID=
JIRA_CLIENT_SECRET=

# ==============================================================================
# Email Configuration (Resend)
# ==============================================================================
# Required for password reset and email verification features
# Sign up at https://resend.com to get an API key
RESEND_API_KEY=
# Frontend URL for email links (password reset, email verification)
FRONTEND_URL=http://localhost:3000

# ==============================================================================
# Temporal Configuration
# ==============================================================================
TEMPORAL_ADDRESS=localhost:7233
TEMPORAL_NAMESPACE=default

# Temporal Database (for self-hosted Temporal)
# Usually same as main database for local development
TEMPORAL_DB_HOST=localhost
TEMPORAL_DB_PORT=5432
TEMPORAL_DB_NAME=flowmaestro_temporal
TEMPORAL_DB_USER=flowmaestro
TEMPORAL_DB_PASSWORD=flowmaestro_dev_password
TEMPORAL_VISIBILITY_DB=flowmaestro_temporal_visibility

# ==============================================================================
# Backend API Configuration
# ==============================================================================
BACKEND_PORT=3001
BACKEND_HOST=localhost
PORT=3001
API_URL=http://localhost:3001
CORS_ORIGIN=http://localhost:3000

# ==============================================================================
# Frontend Configuration
# ==============================================================================
VITE_API_URL=http://localhost:3001
VITE_WS_URL=http://localhost:3001

# ==============================================================================
# Google Cloud Storage (for Knowledge Base documents)
# ==============================================================================
# Required for knowledge base document storage features
GCS_BUCKET_NAME=

# Optional: Signed URL expiration time in seconds (default: 3600 = 1 hour)
GCS_SIGNED_URL_EXPIRATION=3600

# GCS Authentication (for local development)
# ==============================================================================
# Use a service account key to avoid "invalid_rapt" re-authentication errors
# that occur with user credentials (gcloud auth application-default login).
#
# To create a key (requires Service Account Key Admin role or org policy exception):
#   gcloud iam service-accounts keys create ~/.config/gcloud/flowmaestro-storage-key.json \
#       --iam-account=flowmaestro-storage-sa@YOUR_PROJECT.iam.gserviceaccount.com
#
# Then set this variable to the path of the key file:
# GOOGLE_APPLICATION_CREDENTIALS=/Users/YOUR_USERNAME/.config/gcloud/flowmaestro-storage-key.json
#
# Note: In production (GKE), Workload Identity is used instead - no key file needed.

# ==============================================================================
# Secrets Management Helper Scripts
# ==============================================================================
#
# PULL SECRETS FROM GCP (Recommended for local development):
#   ./infra/scripts/sync-secrets-local.sh
#   - Pulls all secrets from GCP Secret Manager
#   - Uses your current gcloud default project
#   - Generates this .env file automatically
#   - Also creates backend/.env for convenience
#
# PUSH SECRETS TO GCP (For initial setup or updates):
#   ./infra/scripts/setup-secrets-gcp.sh
#   - Interactive script to create/update secrets in GCP Secret Manager
#   - Auto-generates secure values for JWT and encryption keys
#   - Uses your current gcloud default project
#
# Prerequisites:
#   - gcloud CLI installed and authenticated
#   - Appropriate permissions on the GCP project
#
